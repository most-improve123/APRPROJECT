<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comercial Palermo - Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script>

// firebase.js
const firebaseConfig = {
  apiKey: "AIzaSyBXuUQeBNWcqtQ9O26_cQquQAJ7gTQuQvs",
  authDomain: "comercialpalermo-fcc0d.firebaseapp.com",
  projectId: "comercialpalermo-fcc0d",
  storageBucket: "comercialpalermo-fcc0d.appspot.com",
  messagingSenderId: "173867339544",
  appId: "1:173867339544:web:YOUR_APP_ID" // Este campo es opcional para el funcionamiento básico, pero recomendado
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();


</script>
</head>
<body>
  <a href="#" id="cartBtn"><i class="fas fa-shopping-cart"></i><span>Carrito</span></a>
  <div id="cartModal" style="display:none;">
    <h3>Mi Carrito</h3>
    <ul id="cartList"></ul>
    <p id="cartTotal"></p>
    <button id="checkoutBtn">Proceder al Pago</button>
  </div>
  <div class="container">
    <header class="header">
      <input type="text" placeholder="Buscar productos..." class="search-bar">
    </header>
    <main class="products">
      <div class="product">
        <img src="img/refrigeradora.png" alt="Refrigeradora">
        <h3>Refrigeradora</h3>
        <button>Comprar</button>
      </div>
      <div class="product">
        <img src="img/televisor.png" alt="Televisor">
        <h3>Televisor</h3>
        <button>Comprar</button>
      </div>
      <div class="product">
        <img src="img/lavadora.png" alt="Lavadora">
        <h3>Lavadora</h3>
        <button>Comprar</button>
      </div>
      <div class="product">
        <img src="img/microondas.jpg" alt="Microondas">
        <h3>Microondas</h3>
        <button>Comprar</button>
      </div>
    </main>
    <nav class="bottom-nav">
      <a href="dashboard.html"><i class="fas fa-home"></i><span>Inicio</span></a>
      <a href="buscar.html"><i class="fas fa-search"></i><span>Buscar</span></a>
      <a href="carrito.html"><i class="fas fa-shopping-cart"></i><span>Carrito</span></a>
      <a href="#" id="logout"><i class="fas fa-sign-out-alt"></i><span>Salir</span></a>
    </nav>
  </div>
  <script>
    // Verifica el estado de autenticación al cargar la página
    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "index.html";
      }
    });

    // ---------- Limpiar producto seleccionado ----------
    localStorage.removeItem("selectedProduct");

    // ---------- Forzar recarga si viene del cache (botón Atrás) ----------
    window.addEventListener('pageshow', function(event) {
      if (event.persisted) {
        window.location.reload();
      }
    });

    // ---------- Manejo de botones Comprar ----------
    document.addEventListener("click", (e) => {
      if (e.target.textContent.trim() === "Comprar") {
        const productCard = e.target.closest(".product");
        if (!productCard) return;
        const productName = productCard.querySelector("h3")?.textContent || "Producto";
        const productImg = productCard.querySelector("img")?.src || "";

        let price = "89.99";
        if (productName.toLowerCase().includes("refrigeradora")) price = "499.99";
        if (productName.toLowerCase().includes("televisor")) price = "299.99";
        if (productName.toLowerCase().includes("lavadora")) price = "399.99";
        if (productName.toLowerCase().includes("microondas")) price = "99.99";

        const product = {
          name: productName,
          img: productImg,
          price: price,
          description: "Producto de alta calidad para tu hogar.",
          specs: [
            "Capacidad: 1.5 L",
            "Material: Acero inoxidable",
            "Peso: 2.5 kg",
            "Dimensiones: 15 x 12 x 20 cm"
          ]
        };
        localStorage.setItem("selectedProduct", JSON.stringify(product));
        window.location.href = "producto.html";
      }
    });

    // ---------- Logout ----------
    const logoutBtn = document.getElementById("logout");
    logoutBtn.addEventListener("click", async () => {
      try {
        await auth.signOut();
        localStorage.removeItem("loggedIn");
        window.location.href = "index.html";
      } catch (error) {
        alert("Error al cerrar sesión: " + error.message);
      }
    });

    const cartBtn = document.getElementById("cartBtn");
    const cartModal = document.getElementById("cartModal");
    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");

    cartBtn.addEventListener("click", () => {
      cartModal.style.display = cartModal.style.display === "none" ? "block" : "none";
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cartList.innerHTML = "";
      let total = 0;
      cart.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - $${item.price} x ${item.quantity} = $${(item.price*item.quantity).toFixed(2)}`;
        cartList.appendChild(li);
        total += item.price*item.quantity;
      });
      cartTotal.textContent = `Total: $${total.toFixed(2)}`;
    });
  </script>
</body>
</html>
